<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>SOUP - Sébastien Ré</title>

    <!-- styles -->
    <link rel="stylesheet" href="./styles/style.css">
    <link rel="stylesheet" href="./styles/w3.css">
    
    <!-- scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ice/3.7.100/Ice.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ice/3.7.100/IceStorm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ice/3.7.100/Glacier2.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ice/3.7.100/IceGrid.js"></script>
    <script src="./scripts/Soup.js"></script> <!-- Ajout de Soup.ice (l'interface) -->
    <script src="./scripts/utils.js"></script>
    <script type="text/javascript"> // initialisation de la connexion Ice
        const serveurs = [
            { name: "rock", host: "localhost", port: 10000, protocol: "ws"},
            { name: "epic", host: "localhost", port: 10001, protocol: "ws"}  
        ]

        let communicator = null;
        let players = [];
        async function init() {
            disable_error();
            const communicator = Ice.initialize();
            if (communicator === null) {
                error("Impossible d'initialiser Ice");
                return;
            }
            players = [];
            for (const serveur of serveurs) {
                try {
                    const proxy = communicator.stringToProxy("MusicLibrary:" + serveur.protocol + " -h " + serveur.host + " -p " + serveur.port);
                    const player = await Soup.MusicLibraryPrx.checkedCast(proxy);
                    players.push(player);
                } catch (e) {
                    error("Impossible de se connecter au serveur " + serveur.name + " : " + e);
                    setTimeout(() => {
                        window.location.reload();
                    }, 3000);
                }
            }
        }
        
        init();

        
    </script>
    <script src="./scripts/Controller.js"></script>

    <!--fav-->
    <link rel="icon" href="./assets/favicon.ico" />
</head>
<body>
    <div id="page" class="w3-container w3-center">
        <!--bandeau notifs-->
        <div id="notif" class="w3-panel w3-sand w3-display-container w3-hide">
            <span onclick="$(this).parent().addClass('w3-hide')" class="w3-button w3-large w3-display-topright">&times;</span>
            <div id="notifContent"></div>
        </div>

        <h1>SOUP Sébastien Ré</h1>
        <audio id="audioPlayer" controls></audio>


        <div id="listeMp3" class="w3-container w3-center">
            <h2>Liste des mp3</h2>
            <table id="tableMp3" class="w3-table w3-striped w3-bordered">
                <thead>
                    <tr>
                        <th>Titre</th>
                        <th>Artiste</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tbodyMp3">
                    <tr>
                        <td colspan="3" class="w3-center">
                            <button type="button" onclick="afficherInfos()">+</button>
                            <div id="infos" class="w3-hide">
                                <input id="inputMp3" type="file" placeholder="Fichier mp3" accept="audio/mp3" multiple="false"  />
                                <input id="inputTitre" type="text" placeholder="Titre" />
                                <input id="inputAuteur" type="text" placeholder="Artiste" />
                                <select id="inputType">
                                    <option value="rock">Rock</option>
                                    <option value="epic">Epic</option>
                                </select>
                                <button type="button" onclick="envoyerMp3()">Envoyer</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

            
    </div>
    

</body>
</html>